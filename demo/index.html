<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>ü•ó Nutrition Tracker - Demo</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d6efd">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Nutrition Tracker Demo">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Track calories, macros and keto index with precision. Mobile-optimized nutrition tracker demo.">
    <meta name="keywords" content="nutrition, calories, keto, health, food tracking, demo">
    
    <!-- Bootstrap CSS (CDN for standalone demo) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* CSS Variables for theming */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --stat-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        [data-theme="dark"] {
            --bg-primary: #212529;
            --bg-secondary: #343a40;
            --bg-card: #343a40;
            --text-primary: #ffffff;
            --text-secondary: #adb5bd;
            --border-color: #6c757d;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --stat-gradient: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
        }

        /* Apply theme variables */
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .card {
            background-color: var(--bg-card);
            border-color: var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .form-control, .form-select {
            background-color: var(--bg-card);
            border-color: var(--border-color);
            color: var(--text-primary);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .form-control option, .form-select option {
            background-color: var(--bg-card);
            color: var(--text-primary);
        }

        .form-label {
            color: var(--text-primary);
        }

        /* Card header styling */
        .card-header {
            background-color: var(--bg-secondary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        /* Table styling */
        .table {
            color: var(--text-primary);
            border-color: var(--border-color);
        }

        .table thead th {
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        .table tbody tr {
            border-color: var(--border-color);
        }

        .table tbody td {
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        .table-hover tbody tr:hover {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Nav tabs styling */
        .nav-tabs {
            border-color: var(--border-color);
        }

        .nav-tabs .nav-link {
            color: var(--text-secondary);
            border-color: transparent;
            transition: color 0.3s ease, border-color 0.3s ease, background-color 0.3s ease;
        }

        .nav-tabs .nav-link:hover {
            color: var(--text-primary);
            border-color: var(--border-color);
            background-color: var(--bg-secondary);
        }

        .nav-tabs .nav-link.active {
            color: var(--text-primary);
            background-color: var(--bg-card);
            border-color: var(--border-color) var(--border-color) var(--bg-card);
        }

        /* Text utilities */
        .text-muted {
            color: var(--text-secondary) !important;
        }

        /* Button styling for outline variants */
        .btn-outline-secondary {
            color: var(--text-secondary);
            border-color: var(--border-color);
        }

        .btn-outline-secondary:hover {
            color: var(--text-primary);
            background-color: var(--bg-secondary);
            border-color: var(--border-color);
        }

        /* Alert styling */
        .alert-info {
            background-color: var(--bg-secondary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        /* Enhanced focus indicators for accessibility */
        .form-control:focus, .btn:focus, .nav-link:focus {
            outline: 3px solid rgba(13, 110, 253, 0.5);
            outline-offset: 2px;
        }

        /* Stats card styling */
        .stats-card {
            background: var(--stat-gradient);
            color: white;
            border: none;
            text-align: center;
            padding: 1.5rem;
        }

        .stats-card h5 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stats-card p {
            margin-bottom: 0;
            opacity: 0.9;
        }

        /* Keto index badges */
        .badge-keto-excellent { background-color: #198754; }
        .badge-keto-good { background-color: #20c997; }
        .badge-keto-moderate { background-color: #ffc107; }
        .badge-keto-poor { background-color: #fd7e14; }
        .badge-keto-bad { background-color: #dc3545; }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container-fluid {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            .card {
                margin-bottom: 1rem;
            }
            
            .btn {
                padding: 0.5rem 1rem;
            }
            
            .table {
                font-size: 0.875rem;
            }
            
            .stats-card h5 {
                font-size: 1.5rem;
            }
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1050;
        }

        /* Loading indicator */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.show {
            display: block;
        }

        /* Demo banner */
        .demo-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-weight: 500;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .demo-banner small {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Demo Banner -->
    <div class="demo-banner">
        üéØ Demo Mode - All data stored locally in your browser
        <small class="d-block d-sm-inline ms-sm-2">(No server required)</small>
    </div>

    <!-- Main Container -->
    <div class="container-fluid py-3">
        <!-- Header -->
        <header class="mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0">ü•ó Nutrition Tracker</h1>
                <div>
                    <button class="btn btn-sm btn-outline-secondary me-2" id="themeToggle" aria-label="Toggle theme">
                        üåì
                    </button>
                    <button class="btn btn-sm btn-outline-danger" id="clearDataBtn" aria-label="Clear all data">
                        üóëÔ∏è Clear Data
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-3" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" 
                        type="button" role="tab" aria-controls="products" aria-selected="true">
                    üì¶ Products
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="dishes-tab" data-bs-toggle="tab" data-bs-target="#dishes" 
                        type="button" role="tab" aria-controls="dishes" aria-selected="false">
                    üçΩÔ∏è Dishes
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="log-tab" data-bs-toggle="tab" data-bs-target="#log" 
                        type="button" role="tab" aria-controls="log" aria-selected="false">
                    üìã Daily Log
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" 
                        type="button" role="tab" aria-controls="stats" aria-selected="false">
                    üìä Statistics
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
            <!-- Products Tab -->
            <div class="tab-pane fade show active" id="products" role="tabpanel" aria-labelledby="products-tab">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Product Management</h5>
                    </div>
                    <div class="card-body">
                        <!-- Add Product Form -->
                        <form id="productForm" class="mb-4">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="productName" class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" id="productName" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="productCategory" class="form-label">Category</label>
                                    <select class="form-select" id="productCategory">
                                        <option value="other">Other</option>
                                        <option value="meat">Meat</option>
                                        <option value="fish">Fish</option>
                                        <option value="dairy">Dairy</option>
                                        <option value="vegetables">Vegetables</option>
                                        <option value="fruits">Fruits</option>
                                        <option value="nuts_seeds">Nuts & Seeds</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="productProtein" class="form-label">Protein (g) *</label>
                                    <input type="number" class="form-control" id="productProtein" step="0.1" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="productFat" class="form-label">Fat (g) *</label>
                                    <input type="number" class="form-control" id="productFat" step="0.1" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="productCarbs" class="form-label">Carbs (g) *</label>
                                    <input type="number" class="form-control" id="productCarbs" step="0.1" required>
                                </div>
                                <div class="col-md-3">
                                    <label for="productCalories" class="form-label">
                                        Calories (per 100g) 
                                        <small class="text-muted">(auto-calculated)</small>
                                    </label>
                                    <input type="number" class="form-control" id="productCalories" step="0.1" readonly style="background-color: var(--bg-secondary);">
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary">Add Product</button>
                                    <button type="button" class="btn btn-secondary" id="loadSampleProducts">Load Sample Data</button>
                                </div>
                            </div>
                        </form>

                        <!-- Products List -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Calories</th>
                                        <th>Protein</th>
                                        <th>Fat</th>
                                        <th>Carbs</th>
                                        <th>Keto Index</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center text-muted">
                                            No products yet. Add your first product or load sample data.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dishes Tab -->
            <div class="tab-pane fade" id="dishes" role="tabpanel" aria-labelledby="dishes-tab">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Dish/Recipe Management</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Dishes feature coming soon in the demo version.</p>
                    </div>
                </div>
            </div>

            <!-- Daily Log Tab -->
            <div class="tab-pane fade" id="log" role="tabpanel" aria-labelledby="log-tab">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Daily Food Log</h5>
                    </div>
                    <div class="card-body">
                        <!-- Add Log Entry Form -->
                        <form id="logForm" class="mb-4">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label for="logDate" class="form-label">Date *</label>
                                    <input type="date" class="form-control" id="logDate" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="logProduct" class="form-label">Product *</label>
                                    <select class="form-select" id="logProduct" required>
                                        <option value="">Select product</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="logQuantity" class="form-label">Quantity (g) *</label>
                                    <input type="number" class="form-control" id="logQuantity" step="1" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="logMealTime" class="form-label">Meal Time</label>
                                    <select class="form-select" id="logMealTime">
                                        <option value="breakfast">üåÖ Breakfast</option>
                                        <option value="lunch">‚òÄÔ∏è Lunch</option>
                                        <option value="dinner">üåô Dinner</option>
                                        <option value="snack">üçé Snack</option>
                                    </select>
                                </div>
                                <div class="col-md-6 d-flex align-items-end">
                                    <button type="submit" class="btn btn-primary">Add to Log</button>
                                </div>
                            </div>
                        </form>

                        <!-- Log Entries -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Meal</th>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Calories</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="logTableBody">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">
                                            No log entries yet. Add your first meal!
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div class="tab-pane fade" id="stats" role="tabpanel" aria-labelledby="stats-tab">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Nutrition Statistics</h5>
                    </div>
                    <div class="card-body">
                        <!-- Stats Cards -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-3 col-6">
                                <div class="card stats-card">
                                    <h5 id="statsCalories">0</h5>
                                    <p>Calories</p>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="card stats-card">
                                    <h5 id="statsProtein">0g</h5>
                                    <p>Protein</p>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="card stats-card">
                                    <h5 id="statsFat">0g</h5>
                                    <p>Fat</p>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="card stats-card">
                                    <h5 id="statsCarbs">0g</h5>
                                    <p>Carbs</p>
                                </div>
                            </div>
                        </div>

                        <!-- Date Filter -->
                        <div class="mb-3">
                            <label for="statsDate" class="form-label">Select Date</label>
                            <input type="date" class="form-control" id="statsDate">
                        </div>

                        <!-- Daily Summary -->
                        <div id="statsSummary" class="alert alert-info">
                            Select a date to view your nutrition statistics for that day.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Bootstrap JS (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Application JavaScript (embedded) -->
    <script>
        // ============================================
        // LocalStorage Data Layer
        // ============================================
        class LocalDataStore {
            constructor() {
                this.KEYS = {
                    PRODUCTS: 'nutricount_products',
                    DISHES: 'nutricount_dishes',
                    LOG: 'nutricount_log',
                    SETTINGS: 'nutricount_settings'
                };
            }

            // Products
            getProducts() {
                const data = localStorage.getItem(this.KEYS.PRODUCTS);
                return data ? JSON.parse(data) : [];
            }

            saveProducts(products) {
                localStorage.setItem(this.KEYS.PRODUCTS, JSON.stringify(products));
            }

            addProduct(product) {
                const products = this.getProducts();
                product.id = Date.now();
                product.created_at = new Date().toISOString();
                products.push(product);
                this.saveProducts(products);
                return product;
            }

            deleteProduct(id) {
                const products = this.getProducts().filter(p => p.id !== id);
                this.saveProducts(products);
            }

            // Log Entries
            getLogEntries() {
                const data = localStorage.getItem(this.KEYS.LOG);
                return data ? JSON.parse(data) : [];
            }

            saveLogEntries(entries) {
                localStorage.setItem(this.KEYS.LOG, JSON.stringify(entries));
            }

            addLogEntry(entry) {
                const entries = this.getLogEntries();
                entry.id = Date.now();
                entry.created_at = new Date().toISOString();
                entries.push(entry);
                this.saveLogEntries(entries);
                return entry;
            }

            deleteLogEntry(id) {
                const entries = this.getLogEntries().filter(e => e.id !== id);
                this.saveLogEntries(entries);
            }

            // Settings
            getSettings() {
                const data = localStorage.getItem(this.KEYS.SETTINGS);
                return data ? JSON.parse(data) : { theme: 'light' };
            }

            saveSettings(settings) {
                localStorage.setItem(this.KEYS.SETTINGS, JSON.stringify(settings));
            }

            // Clear all data
            clearAll() {
                Object.values(this.KEYS).forEach(key => localStorage.removeItem(key));
            }
        }

        // ============================================
        // Nutrition Calculator
        // ============================================
        class NutritionCalculator {
            /**
             * Calculate calories from macronutrients using Atwater system
             * Protein: 4 kcal/g, Carbs: 4 kcal/g, Fat: 9 kcal/g
             */
            static calculateCaloriesFromMacros(protein, fat, carbs) {
                const proteinCal = (protein || 0) * 4.0;
                const fatCal = (fat || 0) * 9.0;
                const carbsCal = (carbs || 0) * 4.0;
                return Math.round((proteinCal + fatCal + carbsCal) * 10) / 10;
            }

            static calculateKetoIndex(fat, protein, carbs) {
                // Keto index calculation: (Fat / (Protein + Carbs))
                const denominator = protein + carbs;
                if (denominator === 0) return fat > 0 ? 10 : 0;
                return fat / denominator;
            }

            static getKetoRating(ketoIndex) {
                if (ketoIndex >= 2.0) return 'Excellent';
                if (ketoIndex >= 1.5) return 'Good';
                if (ketoIndex >= 1.0) return 'Moderate';
                if (ketoIndex >= 0.5) return 'Poor';
                return 'Bad';
            }

            static getKetoBadgeClass(rating) {
                const map = {
                    'Excellent': 'badge-keto-excellent',
                    'Good': 'badge-keto-good',
                    'Moderate': 'badge-keto-moderate',
                    'Poor': 'badge-keto-poor',
                    'Bad': 'badge-keto-bad'
                };
                return map[rating] || 'badge-secondary';
            }

            static calculateEntryNutrition(product, quantity) {
                const factor = quantity / 100;
                return {
                    calories: Math.round(product.calories * factor),
                    protein: Math.round(product.protein * factor * 10) / 10,
                    fat: Math.round(product.fat * factor * 10) / 10,
                    carbs: Math.round(product.carbs * factor * 10) / 10
                };
            }
        }

        // ============================================
        // UI Manager
        // ============================================
        class UIManager {
            static showToast(message, type = 'success') {
                const container = document.querySelector('.toast-container');
                const bgClass = type === 'success' ? 'bg-success' : 'bg-danger';
                
                const toast = document.createElement('div');
                toast.className = `toast align-items-center text-white ${bgClass} border-0`;
                toast.setAttribute('role', 'alert');
                toast.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">${message}</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                `;
                
                container.appendChild(toast);
                const bsToast = new bootstrap.Toast(toast);
                bsToast.show();
                
                toast.addEventListener('hidden.bs.toast', () => toast.remove());
            }

            static getMealEmoji(mealTime) {
                const emojis = {
                    breakfast: 'üåÖ',
                    lunch: '‚òÄÔ∏è',
                    dinner: 'üåô',
                    snack: 'üçé'
                };
                return emojis[mealTime] || 'üçΩÔ∏è';
            }

            static formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            }
        }

        // ============================================
        // Main Application
        // ============================================
        class NutritionTrackerDemo {
            constructor() {
                this.store = new LocalDataStore();
                this.init();
            }

            init() {
                console.log('ü•ó Initializing Nutrition Tracker Demo...');
                
                // Load saved theme
                const settings = this.store.getSettings();
                if (settings.theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }

                // Set today's date as default
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('logDate').value = today;
                document.getElementById('statsDate').value = today;

                // Setup event listeners
                this.setupEventListeners();

                // Load initial data
                this.loadProducts();
                this.loadLogEntries();
                this.updateStats();

                UIManager.showToast('Welcome to Nutrition Tracker Demo! ü•ó');
            }

            setupEventListeners() {
                // Product form
                document.getElementById('productForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addProduct();
                });

                // Auto-calculate calories when macros change
                const autoCalculateCalories = () => {
                    const protein = parseFloat(document.getElementById('productProtein').value) || 0;
                    const fat = parseFloat(document.getElementById('productFat').value) || 0;
                    const carbs = parseFloat(document.getElementById('productCarbs').value) || 0;
                    const calories = NutritionCalculator.calculateCaloriesFromMacros(protein, fat, carbs);
                    document.getElementById('productCalories').value = calories;
                };

                document.getElementById('productProtein').addEventListener('input', autoCalculateCalories);
                document.getElementById('productFat').addEventListener('input', autoCalculateCalories);
                document.getElementById('productCarbs').addEventListener('input', autoCalculateCalories);

                // Log form
                document.getElementById('logForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addLogEntry();
                });

                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => {
                    this.toggleTheme();
                });

                // Clear data button
                document.getElementById('clearDataBtn').addEventListener('click', () => {
                    if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                        this.clearAllData();
                    }
                });

                // Load sample products
                document.getElementById('loadSampleProducts').addEventListener('click', () => {
                    this.loadSampleProducts();
                });

                // Stats date filter
                document.getElementById('statsDate').addEventListener('change', () => {
                    this.updateStats();
                });

                // Tab switch handler
                document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
                    tab.addEventListener('shown.bs.tab', (e) => {
                        if (e.target.id === 'stats-tab') {
                            this.updateStats();
                        }
                    });
                });
            }

            // Product Management
            addProduct() {
                const product = {
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    calories: parseFloat(document.getElementById('productCalories').value),
                    protein: parseFloat(document.getElementById('productProtein').value),
                    fat: parseFloat(document.getElementById('productFat').value),
                    carbs: parseFloat(document.getElementById('productCarbs').value)
                };

                this.store.addProduct(product);
                this.loadProducts();
                document.getElementById('productForm').reset();
                UIManager.showToast('Product added successfully!');
            }

            loadProducts() {
                const products = this.store.getProducts();
                const tbody = document.getElementById('productsTableBody');
                const logSelect = document.getElementById('logProduct');

                if (products.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No products yet. Add your first product or load sample data.</td></tr>';
                    logSelect.innerHTML = '<option value="">Select product</option>';
                    return;
                }

                // Update products table
                tbody.innerHTML = products.map(product => {
                    const ketoIndex = NutritionCalculator.calculateKetoIndex(
                        product.fat, product.protein, product.carbs
                    );
                    const rating = NutritionCalculator.getKetoRating(ketoIndex);
                    const badgeClass = NutritionCalculator.getKetoBadgeClass(rating);

                    return `
                        <tr>
                            <td>${product.name}</td>
                            <td>${product.calories}</td>
                            <td>${product.protein}g</td>
                            <td>${product.fat}g</td>
                            <td>${product.carbs}g</td>
                            <td><span class="badge ${badgeClass}">${rating} (${ketoIndex.toFixed(2)})</span></td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="app.deleteProduct(${product.id})">
                                    Delete
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');

                // Update log select
                logSelect.innerHTML = '<option value="">Select product</option>' + 
                    products.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            }

            deleteProduct(id) {
                if (confirm('Are you sure you want to delete this product?')) {
                    this.store.deleteProduct(id);
                    this.loadProducts();
                    UIManager.showToast('Product deleted successfully!');
                }
            }

            loadSampleProducts() {
                const sampleProducts = [
                    { name: 'Chicken Breast', category: 'meat', calories: 165, protein: 31, fat: 3.6, carbs: 0 },
                    { name: 'Salmon', category: 'fish', calories: 208, protein: 25.4, fat: 12.4, carbs: 0 },
                    { name: 'Eggs', category: 'dairy', calories: 155, protein: 13, fat: 11, carbs: 1.1 },
                    { name: 'Avocado', category: 'fruits', calories: 160, protein: 2, fat: 14.7, carbs: 8.5 },
                    { name: 'Broccoli', category: 'vegetables', calories: 34, protein: 2.8, fat: 0.4, carbs: 6.6 },
                    { name: 'Almonds', category: 'nuts_seeds', calories: 579, protein: 21.2, fat: 49.9, carbs: 21.6 },
                    { name: 'Spinach', category: 'vegetables', calories: 23, protein: 2.9, fat: 0.4, carbs: 3.6 },
                    { name: 'Blueberries', category: 'fruits', calories: 57, protein: 0.7, fat: 0.3, carbs: 14.5 }
                ];

                sampleProducts.forEach(product => this.store.addProduct(product));
                this.loadProducts();
                UIManager.showToast('Sample products loaded successfully!');
            }

            // Log Management
            addLogEntry() {
                const productId = parseInt(document.getElementById('logProduct').value);
                const product = this.store.getProducts().find(p => p.id === productId);
                
                if (!product) {
                    UIManager.showToast('Please select a product', 'error');
                    return;
                }

                const quantity = parseFloat(document.getElementById('logQuantity').value);
                const nutrition = NutritionCalculator.calculateEntryNutrition(product, quantity);

                const entry = {
                    date: document.getElementById('logDate').value,
                    product_id: productId,
                    product_name: product.name,
                    quantity: quantity,
                    meal_time: document.getElementById('logMealTime').value,
                    ...nutrition
                };

                this.store.addLogEntry(entry);
                this.loadLogEntries();
                this.updateStats();
                
                // Reset quantity only
                document.getElementById('logQuantity').value = '';
                UIManager.showToast('Entry added to log!');
            }

            loadLogEntries() {
                const entries = this.store.getLogEntries().sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );
                const tbody = document.getElementById('logTableBody');

                if (entries.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No log entries yet. Add your first meal!</td></tr>';
                    return;
                }

                tbody.innerHTML = entries.map(entry => `
                    <tr>
                        <td>${UIManager.formatDate(entry.date)}</td>
                        <td>${UIManager.getMealEmoji(entry.meal_time)} ${entry.meal_time}</td>
                        <td>${entry.product_name}</td>
                        <td>${entry.quantity}g</td>
                        <td>${entry.calories} kcal</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="app.deleteLogEntry(${entry.id})">
                                Delete
                            </button>
                        </td>
                    </tr>
                `).join('');
            }

            deleteLogEntry(id) {
                if (confirm('Are you sure you want to delete this entry?')) {
                    this.store.deleteLogEntry(id);
                    this.loadLogEntries();
                    this.updateStats();
                    UIManager.showToast('Entry deleted successfully!');
                }
            }

            // Statistics
            updateStats() {
                const selectedDate = document.getElementById('statsDate').value;
                const entries = this.store.getLogEntries().filter(e => e.date === selectedDate);

                const totals = entries.reduce((acc, entry) => ({
                    calories: acc.calories + entry.calories,
                    protein: acc.protein + entry.protein,
                    fat: acc.fat + entry.fat,
                    carbs: acc.carbs + entry.carbs
                }), { calories: 0, protein: 0, fat: 0, carbs: 0 });

                document.getElementById('statsCalories').textContent = totals.calories;
                document.getElementById('statsProtein').textContent = totals.protein.toFixed(1) + 'g';
                document.getElementById('statsFat').textContent = totals.fat.toFixed(1) + 'g';
                document.getElementById('statsCarbs').textContent = totals.carbs.toFixed(1) + 'g';

                const summary = document.getElementById('statsSummary');
                if (entries.length === 0) {
                    summary.innerHTML = `<strong>No entries for ${UIManager.formatDate(selectedDate)}</strong><br>Add some meals to see your statistics!`;
                } else {
                    summary.innerHTML = `
                        <strong>${UIManager.formatDate(selectedDate)} Summary</strong><br>
                        ${entries.length} meal${entries.length > 1 ? 's' : ''} logged with ${totals.calories} total calories
                    `;
                }
            }

            // Theme Management
            toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                
                const settings = this.store.getSettings();
                settings.theme = newTheme;
                this.store.saveSettings(settings);
                
                UIManager.showToast(`Switched to ${newTheme} theme`);
            }

            // Data Management
            clearAllData() {
                this.store.clearAll();
                this.loadProducts();
                this.loadLogEntries();
                this.updateStats();
                UIManager.showToast('All data cleared!');
            }
        }

        // Initialize app when DOM is ready
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new NutritionTrackerDemo();
        });
    </script>
</body>
</html>
