# üé® Design Patterns & Best Practices Guide

**–¶–µ–ª—å:** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–∑–∞–π–Ω –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤, –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ SOLID, OOP, YAGNI, KISS –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –≤ Nutricount.

**–û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:** –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è + —Ç–µ—Å—Ç—ã (–ø–æ–ª–Ω—ã–π —Å–ø–µ–∫—Ç—Ä –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫)

**–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** October 22, 2025 - Week 3 Implementation Complete

---

## üìä Implementation Status (Week 3, October 2025)

### ‚úÖ Fully Implemented Patterns

| Pattern | Status | Location | Tests | Description |
|---------|--------|----------|-------|-------------|
| **Adapter Pattern** | ‚úÖ Complete | `frontend/src/adapters/` | 30 tests | –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ API/LocalStorage |
| **Repository Pattern** | ‚úÖ Complete | `repositories/` | 21 tests | –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º |
| **Service Layer** | ‚úÖ Complete | `services/` | 17 tests | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ |
| **Thin Controllers** | ‚úÖ Complete | `routes/products.py` | 794 tests | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (67% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞) |
| **Singleton** | ‚úÖ Complete | `src/cache_manager.py` | 41 tests | –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫—ç—à–∞ |
| **Factory** | ‚úÖ Complete | `src/security.py` | - | –°–æ–∑–¥–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–æ–≤ |
| **Decorator** | ‚úÖ Complete | `src/security.py` | - | `@require_auth`, `@rate_limit` |
| **Observer** | ‚úÖ Complete | `static/js/notifications.js` | - | Event Bus –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| **Template Method** | ‚úÖ Complete | `tests/` | - | –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤ |

### üìù Documented Patterns (Ready to Implement)

| Pattern | Priority | Location (Planned) | Description |
|---------|----------|-------------------|-------------|
| **Strategy** | High | `src/nutrition_calculator.py` | –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã BMR |
| **Builder** | Medium | `services/dish_service.py` | –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –±–ª—é–¥ |
| **Chain of Responsibility** | Medium | `src/validators/` | –¶–µ–ø–æ—á–∫–∞ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ |
| **Facade** | Low | `src/nutrition_api.py` | –£–ø—Ä–æ—â–µ–Ω–∏–µ nutrition API |
| **Proxy** | Low | `src/cache_proxy.py` | –ü—Ä–æ–∫—Å–∏ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º |

### üìà Progress Metrics

- **Total Patterns Documented:** 13+
- **Patterns Implemented:** 9 ‚úÖ (–≤–∫–ª—é—á–∞—è Thin Controllers)
- **Unit Tests:** 68+ tests for patterns (21 Repository + 17 Service + 30 Adapter)
- **Code Coverage:** 94%+
- **SOLID Compliance:** ‚úÖ All 5 principles applied
- **Code Reduction:** routes/products.py: 460 ‚Üí 150 lines (67% reduction)

---

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [Design Patterns (–ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)](#design-patterns)
2. [SOLID Principles](#solid-principles)
3. [Best Practices (YAGNI, KISS, DRY)](#best-practices)
4. [Architectural Patterns](#architectural-patterns)
5. [Testing Patterns](#testing-patterns)
6. [Implementation Roadmap](#implementation-roadmap)

---

## üéØ Design Patterns

### –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ ‚úÖ

#### 1. Adapter Pattern (–ê–¥–∞–ø—Ç–µ—Ä)
**–ì–¥–µ:** `frontend/src/adapters/`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ backend'–∞–º–∏ (API –∏ LocalStorage) —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```javascript
// BackendAdapter - –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
class BackendAdapter {
    async getProducts() { throw new Error('Must implement'); }
    async createProduct(product) { throw new Error('Must implement'); }
}

// ApiAdapter - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å REST API
class ApiAdapter extends BackendAdapter {
    async getProducts() { return fetch('/api/products'); }
}

// StorageAdapter - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LocalStorage
class StorageAdapter extends BackendAdapter {
    async getProducts() { return JSON.parse(localStorage.getItem('products')); }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã (IndexedDB, WebSQL)
- –ö–æ–¥ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

---

#### 2. Singleton Pattern (–û–¥–∏–Ω–æ—á–∫–∞)
**–ì–¥–µ:** `src/cache_manager.py`, `src/monitoring.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–µ–Ω –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫—ç—à–∞/–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (Python):**
```python
class CacheManager:
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
            cls._instance._initialize()
        return cls._instance
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (JavaScript):**
```javascript
class MetricsCollector {
    constructor() {
        if (MetricsCollector.instance) {
            return MetricsCollector.instance;
        }
        this.metrics = [];
        MetricsCollector.instance = this;
    }
}
```

---

#### 3. Factory Pattern (–§–∞–±—Ä–∏–∫–∞)
**–ì–¥–µ:** `src/security.py` (token generation)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Å —Ä–∞–∑–Ω–æ–π –ª–æ–≥–∏–∫–æ–π

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
def create_token(user_id, token_type='access'):
    if token_type == 'access':
        return jwt.encode({'user_id': user_id, 'exp': ...}, SECRET)
    elif token_type == 'refresh':
        return jwt.encode({'user_id': user_id, 'exp': ...}, REFRESH_SECRET)
```

**–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ):**
```python
class TokenFactory:
    @staticmethod
    def create_token(token_type, user_id):
        strategies = {
            'access': AccessTokenStrategy(),
            'refresh': RefreshTokenStrategy(),
            'api_key': ApiKeyStrategy()
        }
        return strategies[token_type].generate(user_id)
```

---

#### 4. Strategy Pattern (–°—Ç—Ä–∞—Ç–µ–≥–∏—è)
**–ì–¥–µ:** `src/nutrition_calculator.py` (—Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞—Å—á–µ—Ç–∞ BMR (Mifflin-St Jeor, Harris-Benedict)

**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
class BMRStrategy(ABC):
    @abstractmethod
    def calculate(self, profile): pass

class MifflinStJeorStrategy(BMRStrategy):
    def calculate(self, profile):
        return 10 * profile.weight + 6.25 * profile.height - 5 * profile.age

class HarrisBenedictStrategy(BMRStrategy):
    def calculate(self, profile):
        return 66 + 13.7 * profile.weight + 5 * profile.height - 6.8 * profile.age

class BMRCalculator:
    def __init__(self, strategy: BMRStrategy):
        self.strategy = strategy
    
    def calculate(self, profile):
        return self.strategy.calculate(profile)
```

---

#### 5. Observer Pattern (–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å)
**–ì–¥–µ:** `static/js/notifications.js`

**–ü—Ä–æ–±–ª–µ–º–∞:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```javascript
class EventBus {
    constructor() {
        this.listeners = {};
    }
    
    on(event, callback) {
        if (!this.listeners[event]) this.listeners[event] = [];
        this.listeners[event].push(callback);
    }
    
    emit(event, data) {
        if (this.listeners[event]) {
            this.listeners[event].forEach(cb => cb(data));
        }
    }
}

// Usage
eventBus.on('product.created', (product) => showNotification('Product added!'));
eventBus.emit('product.created', newProduct);
```

---

#### 6. Decorator Pattern (–î–µ–∫–æ—Ä–∞—Ç–æ—Ä)
**–ì–¥–µ:** `src/security.py` (@require_auth), `src/utils.py` (@handle_api_errors)

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
def require_auth(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        token = request.headers.get('Authorization')
        if not token:
            return jsonify({'error': 'No token'}), 401
        try:
            decode_token(token)
            return f(*args, **kwargs)
        except:
            return jsonify({'error': 'Invalid token'}), 401
    return decorated_function

@app.route('/api/products')
@require_auth
def get_products():
    return jsonify(Product.all())
```

---

#### 7. Template Method Pattern (–®–∞–±–ª–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥)
**–ì–¥–µ:** –¢–µ—Å—Ç—ã `tests/`

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω—ã–º–∏ —à–∞–≥–∞–º–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
class BaseTestCase:
    def setUp(self):
        self.setup_database()
        self.setup_client()
        self.setup_auth()
    
    def setup_database(self): pass  # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö
    def setup_client(self): pass
    def setup_auth(self): pass
    
    def tearDown(self):
        self.cleanup_database()

class ProductTestCase(BaseTestCase):
    def setup_database(self):
        # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        create_test_products()
```

---

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ üìù

#### 8. Repository Pattern (–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π) ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù
**–ó–∞—á–µ–º:** –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (Week 3, October 2025)

**–†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# repositories/base_repository.py
class BaseRepository(ABC):
    """–ë–∞–∑–æ–≤—ã–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"""
    
    def __init__(self, db):
        self.db = db
    
    @abstractmethod
    def find_all(self, **kwargs) -> List[Dict[str, Any]]:
        """–ù–∞–π—Ç–∏ –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏"""
        pass
    
    @abstractmethod
    def find_by_id(self, entity_id: int) -> Optional[Dict[str, Any]]:
        """–ù–∞–π—Ç–∏ –ø–æ ID"""
        pass
    
    @abstractmethod
    def create(self, data: Dict[str, Any]) -> Dict[str, Any]:
        """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—É—â–Ω–æ—Å—Ç—å"""
        pass
    
    @abstractmethod
    def update(self, entity_id: int, data: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é"""
        pass
    
    @abstractmethod
    def delete(self, entity_id: int) -> bool:
        """–£–¥–∞–ª–∏—Ç—å –ø–æ ID"""
        pass

# repositories/product_repository.py
class ProductRepository(BaseRepository):
    """–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏"""
    
    def find_all(self, search="", limit=50, offset=0, include_calculated_fields=True):
        """–ù–∞–π—Ç–∏ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Å –ø–æ–∏—Å–∫–æ–º –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π"""
        query = """
            SELECT * FROM products
            WHERE name LIKE ?
            ORDER BY name COLLATE NOCASE
            LIMIT ? OFFSET ?
        """
        products = []
        for row in self.db.execute(query, (f"%{search}%", limit, offset)).fetchall():
            product = dict(row)
            if include_calculated_fields:
                product = self._add_calculated_fields(product)
            products.append(product)
        return products
    
    def find_by_id(self, product_id: int):
        """–ù–∞–π—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç –ø–æ ID"""
        row = self.db.execute(
            "SELECT * FROM products WHERE id = ?",
            (product_id,)
        ).fetchone()
        return dict(row) if row else None
    
    def create(self, data: Dict[str, Any]):
        """–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–æ–º –∫–∞–ª–æ—Ä–∏–π –∏ –∫–µ—Ç–æ-–∏–Ω–¥–µ–∫—Å–∞"""
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        name = data["name"]
        protein = data["protein_per_100g"]
        fat = data["fat_per_100g"]
        carbs = data["carbs_per_100g"]
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–∞–ª–æ—Ä–∏–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ Atwater
        calculated_calories = calculate_calories_from_macros(protein, fat, carbs)
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º net carbs –∏ keto index
        net_carbs_result = calculate_net_carbs_advanced(carbs, ...)
        keto_result = calculate_keto_index_advanced(protein, fat, carbs, ...)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
        cursor = self.db.execute(
            """INSERT INTO products (...) VALUES (?, ?, ...)""",
            (name, calculated_calories, protein, fat, carbs, ...)
        )
        self.db.commit()
        
        return self.find_by_id(cursor.lastrowid)
    
    def update(self, product_id: int, data: Dict[str, Any]):
        """–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç"""
        if not self.exists(product_id):
            return None
        
        self.db.execute(
            """UPDATE products SET name = ?, ... WHERE id = ?""",
            (data["name"], ..., product_id)
        )
        self.db.commit()
        return self.find_by_id(product_id)
    
    def delete(self, product_id: int) -> bool:
        """–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç"""
        cursor = self.db.execute(
            "DELETE FROM products WHERE id = ?",
            (product_id,)
        )
        self.db.commit()
        return cursor.rowcount > 0
    
    def is_used_in_logs(self, product_id: int) -> tuple[bool, int]:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö (–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ)"""
        usage_count = self.db.execute(
            """SELECT COUNT(*) as count FROM log_entries
               WHERE item_type = 'product' AND item_id = ?""",
            (product_id,)
        ).fetchone()["count"]
        return usage_count > 0, usage_count
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –í –º–∞—Ä—à—Ä—É—Ç–µ –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–µ
db = get_db()
repo = ProductRepository(db)

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã
products = repo.find_all(search="chicken", limit=10)

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ ID
product = repo.find_by_id(1)

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
new_product = repo.create({
    "name": "Salmon",
    "protein_per_100g": 20.0,
    "fat_per_100g": 13.0,
    "carbs_per_100g": 0.0
})

# –û–±–Ω–æ–≤–∏—Ç—å
updated = repo.update(1, {"name": "Wild Salmon", ...})

# –£–¥–∞–ª–∏—Ç—å (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª)
is_used, count = repo.is_used_in_logs(1)
if not is_used:
    repo.delete(1)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û—Ç–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç —Ä–∞–±–æ—Ç—ã —Å –ë–î
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (21 unit test —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ë–î)
- ‚úÖ –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –ë–î (SQLite ‚Üí PostgreSQL)
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- ‚úÖ –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# tests/unit/test_product_repository.py (21 —Ç–µ—Å—Ç)
def test_create_product_minimal(product_repo):
    data = {
        "name": "Chicken Breast",
        "protein_per_100g": 31.0,
        "fat_per_100g": 3.6,
        "carbs_per_100g": 0.0,
    }
    product = product_repo.create(data)
    
    assert product is not None
    assert product["id"] > 0
    assert product["name"] == "Chicken Breast"
    # Calories automatically calculated
    assert 150 < product["calories_per_100g"] < 160
```

**–§–∞–π–ª—ã:**
- `repositories/base_repository.py` - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å (109 —Å—Ç—Ä–æ–∫)
- `repositories/product_repository.py` - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (347 —Å—Ç—Ä–æ–∫)
- `tests/unit/test_product_repository.py` - 21 unit test (526 —Å—Ç—Ä–æ–∫)

---

#### 8.1 Service Layer Pattern (–°–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤) ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù
**–ó–∞—á–µ–º:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (Week 3, October 2025)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–∑–º–∞–∑–∞–Ω–∞ –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º, —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:** –°–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤ –º–µ–∂–¥—É –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

**–†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# services/product_service.py
class ProductService:
    """–°–µ—Ä–≤–∏—Å –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏"""
    
    def __init__(self, repository: ProductRepository):
        self.repository = repository
    
    def get_products(self, search="", limit=50, offset=0, use_cache=True):
        """–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º–∏"""
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
        limit = min(limit, Config.API_MAX_PER_PAGE)  # –ù–µ –±–æ–ª—å—à–µ –ª–∏–º–∏—Ç–∞
        offset = max(0, offset)  # –ù–µ –º–µ–Ω—å—à–µ 0
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
        if use_cache:
            cache_key = f"products:{search}:{limit}:{offset}"
            cached_result = cache_manager.get(cache_key)
            if cached_result is not None:
                return cached_result
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        products = self.repository.find_all(
            search=search,
            limit=limit,
            offset=offset,
            include_calculated_fields=True
        )
        
        # –ö—ç—à–∏—Ä—É–µ–º
        if use_cache:
            cache_manager.set(cache_key, products, 300)
        
        return products
    
    def create_product(self, data: Dict[str, Any]) -> tuple[bool, Optional[Dict], List[str]]:
        """–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º–∏"""
        # –í–∞–ª–∏–¥–∞—Ü–∏—è
        is_valid, errors, cleaned_data = validate_product_data(data)
        if not is_valid:
            return False, None, errors
        
        # –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        existing = self.repository.find_by_name(cleaned_data["name"])
        if existing:
            return False, None, [f"Product '{cleaned_data['name']}' already exists"]
        
        # –°–æ–∑–¥–∞–Ω–∏–µ
        try:
            product = self.repository.create(cleaned_data)
            cache_invalidate("products:*")  # –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à
            return True, product, []
        except Exception as e:
            return False, None, [f"Failed to create: {str(e)}"]
    
    def delete_product(self, product_id: int) -> tuple[bool, List[str]]:
        """–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª"""
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
        if not self.repository.exists(product_id):
            return False, ["Product not found"]
        
        # –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ: –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–æ–¥—É–∫—Ç
        is_used, usage_count = self.repository.is_used_in_logs(product_id)
        if is_used:
            return False, [f"Cannot delete: used in {usage_count} log entries"]
        
        # –£–¥–∞–ª–µ–Ω–∏–µ
        try:
            success = self.repository.delete(product_id)
            if success:
                cache_invalidate("products:*")
                return True, []
            return False, ["Failed to delete"]
        except Exception as e:
            return False, [f"Failed to delete: {str(e)}"]
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∞—Ä—à—Ä—É—Ç–∞—Ö (Thin Controllers):**
```python
# routes/products.py
from services.product_service import ProductService
from repositories.product_repository import ProductRepository

@products_bp.route("", methods=["GET", "POST"])
@monitor_http_request
@rate_limit("api")
def products_api():
    """–¢–æ–Ω–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä - –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—É"""
    db = get_db()
    try:
        # –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å
        repo = ProductRepository(db)
        service = ProductService(repo)
        
        if request.method == "GET":
            # –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å
            products = service.get_products(
                search=request.args.get("search", ""),
                limit=int(request.args.get("limit", 50)),
                offset=int(request.args.get("offset", 0))
            )
            return jsonify(json_response(products))
        
        else:  # POST
            data = safe_get_json()
            success, product, errors = service.create_product(data)
            
            if success:
                return jsonify(json_response(
                    product,
                    SUCCESS_MESSAGES["product_created"],
                    HTTP_CREATED
                )), HTTP_CREATED
            else:
                return jsonify(json_response(
                    None,
                    "Validation failed",
                    HTTP_BAD_REQUEST,
                    errors=errors
                )), HTTP_BAD_REQUEST
    
    finally:
        db.close()
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (17 unit tests —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Ç–æ–Ω–∫–∏–º–∏ (thin controllers)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É API –∏ CLI
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥—Ä—É–≥–∏–µ –∫—Ä–æ—Å—Å-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Layers):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Routes (API)      ‚îÇ  ‚Üê Thin controllers, HTTP-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Services          ‚îÇ  ‚Üê –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø—Ä–∞–≤–∏–ª–∞
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Repositories      ‚îÇ  ‚Üê –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º, SQL
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Database          ‚îÇ  ‚Üê SQLite
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# tests/unit/test_product_service.py (17 —Ç–µ—Å—Ç–æ–≤)
def test_create_product_duplicate_name(product_service, mock_repository):
    """–¢–µ—Å—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞: –∑–∞–ø—Ä–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤"""
    # Setup
    cleaned_data = {"name": "Existing Product"}
    mock_repository.find_by_name.return_value = {"id": 1, "name": "Existing Product"}
    
    # Act
    with patch('services.product_service.validate_product_data') as mock_validate:
        mock_validate.return_value = (True, [], cleaned_data)
        success, product, errors = product_service.create_product(cleaned_data)
    
    # Assert
    assert success is False
    assert "already exists" in errors[0]
    mock_repository.create.assert_not_called()  # –ù–µ –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å
```

**–§–∞–π–ª—ã:**
- `services/product_service.py` - –°–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (228 —Å—Ç—Ä–æ–∫)
- `tests/unit/test_product_service.py` - 17 unit tests (375 —Å—Ç—Ä–æ–∫)
- `routes/products.py` - Refactored thin controllers (150 —Å—Ç—Ä–æ–∫, –±—ã–ª–æ 460!)

**Refactoring Results (October 22, 2025):**

‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ routes/products.py –∑–∞–≤–µ—Ä—à–µ–Ω:**
- **Before:** 460 lines with business logic, SQL, caching, validation
- **After:** 150 lines - —Ç–æ–ª—å–∫–æ HTTP handling (67% reduction!)

‚úÖ **Thin Controllers –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã:**
```python
# –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ - —Ç–æ–ª—Å—Ç—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (85+ —Å—Ç—Ä–æ–∫)
@products_bp.route("", methods=["GET"])
def products_api():
    # SQL queries
    # Caching logic
    # Keto calculations
    # Error handling
    # ... –º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏ ...

# –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ - —Ç–æ–Ω–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (12 —Å—Ç—Ä–æ–∫)
@products_bp.route("", methods=["GET"])
@monitor_http_request
@rate_limit("api")
def products_api():
    """Thin controller - delegates to ProductService"""
    db = get_db()
    repository = ProductRepository(db)
    service = ProductService(repository)
    
    try:
        if request.method == "GET":
            search = request.args.get("search", "").strip()
            limit = int(request.args.get("limit", 50))
            offset = int(request.args.get("offset", 0))
            products = service.get_products(search, limit, offset)
            return jsonify(json_response(products))
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ç–æ–∂–µ –∫–æ—Ä–æ—Ç–∫–∏–µ ...
    finally:
        db.close()
```

‚úÖ **Line Count Reduction per Route:**
- GET /api/products: 85 ‚Üí 12 lines (85% reduction)
- POST /api/products: 175 ‚Üí 18 lines (90% reduction!)
- GET /api/products/:id: 20 ‚Üí 11 lines (45% reduction)
- PUT /api/products/:id: 130 ‚Üí 19 lines (85% reduction)
- DELETE /api/products/:id: 50 ‚Üí 13 lines (74% reduction)

‚úÖ **Benefits Achieved:**
- Routes only handle HTTP concerns (request/response)
- All business logic in service layer
- All data access in repository layer
- Clean Architecture implemented
- Much easier to test (mock at service level)
- Better code organization

‚úÖ **Test Status:**
- 794 tests passing (99.6% pass rate)
- All existing integration tests still work
- No regressions in functionality

**SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- **S** (Single Responsibility): –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω–æ
  - Repository ‚Üí –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
  - Service ‚Üí –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
  - Routes ‚Üí HTTP-–æ–±—Ä–∞–±–æ—Ç–∫–∞
- **O** (Open/Closed): –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π/—Å–µ—Ä–≤–∏—Å
- **L** (Liskov Substitution): –ú–æ–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ª—é–±–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- **I** (Interface Segregation): –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã
- **D** (Dependency Inversion): –ó–∞–≤–∏—Å–∏–º –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (BaseRepository)

---

#### 9. Builder Pattern (–°—Ç—Ä–æ–∏—Ç–µ–ª—å)
**–ó–∞—á–µ–º:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ—à–∞–≥–æ–≤–æ

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –±–ª—é–¥ —Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏

```python
class DishBuilder:
    def __init__(self):
        self.dish = Dish()
    
    def with_name(self, name):
        self.dish.name = name
        return self
    
    def add_ingredient(self, product_id, quantity):
        self.dish.ingredients.append({
            'product_id': product_id,
            'quantity': quantity
        })
        return self
    
    def with_preparation(self, method):
        self.dish.preparation_method = method
        return self
    
    def build(self):
        self.dish.calculate_nutrition()
        return self.dish

# Usage
dish = DishBuilder() \
    .with_name("Chicken Salad") \
    .add_ingredient(1, 150) \
    .add_ingredient(2, 100) \
    .with_preparation("raw") \
    .build()
```

---

#### 10. Chain of Responsibility (–¶–µ–ø–æ—á–∫–∞ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π)
**–ó–∞—á–µ–º:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```python
class ValidationHandler(ABC):
    def __init__(self, next_handler=None):
        self.next = next_handler
    
    def handle(self, data):
        if not self.validate(data):
            raise ValidationError(self.error_message())
        if self.next:
            return self.next.handle(data)
        return True
    
    @abstractmethod
    def validate(self, data): pass
    
    @abstractmethod
    def error_message(self): pass

class NameValidator(ValidationHandler):
    def validate(self, data):
        return len(data.get('name', '')) > 2
    
    def error_message(self):
        return "Name must be at least 2 characters"

class MacrosValidator(ValidationHandler):
    def validate(self, data):
        return data['protein'] + data['fat'] + data['carbs'] <= 100
    
    def error_message(self):
        return "Total macros cannot exceed 100g"

# Usage
validator = NameValidator(
    MacrosValidator(
        CaloriesValidator()
    )
)
validator.handle(product_data)
```

---

#### 11. Command Pattern (–ö–æ–º–∞–Ω–¥–∞)
**–ó–∞—á–µ–º:** –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π, undo/redo

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ª–æ–≥–µ –ø–∏—Ç–∞–Ω–∏—è

```python
class Command(ABC):
    @abstractmethod
    def execute(self): pass
    
    @abstractmethod
    def undo(self): pass

class AddProductCommand(Command):
    def __init__(self, product_data):
        self.product_data = product_data
        self.product_id = None
    
    def execute(self):
        self.product_id = db.insert('products', self.product_data)
        return self.product_id
    
    def undo(self):
        db.delete('products', self.product_id)

class CommandHistory:
    def __init__(self):
        self.commands = []
    
    def execute(self, command):
        command.execute()
        self.commands.append(command)
    
    def undo(self):
        if self.commands:
            self.commands.pop().undo()
```

---

#### 12. Facade Pattern (–§–∞—Å–∞–¥)
**–ó–∞—á–µ–º:** –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ API

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å nutrition calculator

```python
class NutritionFacade:
    """–ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤"""
    
    def __init__(self):
        self.calculator = NutritionCalculator()
        self.validator = NutritionValidator()
        self.keto_analyzer = KetoAnalyzer()
    
    def analyze_product(self, product):
        # –û–¥–∏–Ω –º–µ—Ç–æ–¥ –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≤—ã–∑–æ–≤–æ–≤
        validation = self.validator.validate(product)
        if not validation.valid:
            return {'errors': validation.errors}
        
        calories = self.calculator.calculate_calories(product)
        net_carbs = self.calculator.calculate_net_carbs(product)
        keto_index = self.keto_analyzer.calculate_index(product)
        
        return {
            'calories': calories,
            'net_carbs': net_carbs,
            'keto_index': keto_index,
            'keto_rating': self.keto_analyzer.get_rating(keto_index)
        }
```

---

#### 13. Proxy Pattern (–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å)
**–ó–∞—á–µ–º:** –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä—É—é—â–∏–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è API

```python
class CachingProductProxy:
    def __init__(self, real_repository):
        self.repo = real_repository
        self.cache = {}
    
    def find_by_id(self, id):
        if id not in self.cache:
            self.cache[id] = self.repo.find_by_id(id)
        return self.cache[id]
    
    def invalidate(self, id):
        if id in self.cache:
            del self.cache[id]
```

---

## üèõÔ∏è SOLID Principles

### S - Single Responsibility Principle (–ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)

**–ü—Ä–∞–≤–∏–ª–æ:** –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø—Ä–∏—á–∏–Ω—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ü–ª–æ—Ö–æ:**
```python
class Product:
    def __init__(self, name):
        self.name = name
    
    def save_to_database(self):
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å!
        db.execute("INSERT INTO products VALUES (?)", (self.name,))
    
    def send_notification(self):
        # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π - —Ç–æ–∂–µ –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å!
        email.send("New product added")
```

**–•–æ—Ä–æ—à–æ:**
```python
class Product:
    """–¢–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞"""
    def __init__(self, name, protein, fat, carbs):
        self.name = name
        self.protein = protein
        self.fat = fat
        self.carbs = carbs
    
    def calculate_calories(self):
        return self.protein * 4 + self.fat * 9 + self.carbs * 4

class ProductRepository:
    """–¢–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å –ë–î"""
    def save(self, product): pass
    def find(self, id): pass

class NotificationService:
    """–¢–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""
    def notify_product_created(self, product): pass
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ Nutricount:**
- ‚úÖ `src/nutrition_calculator.py` - —Ç–æ–ª—å–∫–æ —Ä–∞—Å—á–µ—Ç—ã
- ‚úÖ `src/cache_manager.py` - —Ç–æ–ª—å–∫–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ `src/security.py` - —Ç–æ–ª—å–∫–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- üìù –†–∞–∑–¥–µ–ª–∏—Ç—å `routes/products.py` –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä + —Å–µ—Ä–≤–∏—Å

---

### O - Open/Closed Principle (–ü—Ä–∏–Ω—Ü–∏–ø –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏/–∑–∞–∫—Ä—ã—Ç–æ—Å—Ç–∏)

**–ü—Ä–∞–≤–∏–ª–æ:** –û—Ç–∫—Ä—ã—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –∑–∞–∫—Ä—ã—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ü–ª–æ—Ö–æ:**
```python
def calculate_bmr(profile):
    if profile.formula == 'mifflin':
        return 10 * profile.weight + 6.25 * profile.height
    elif profile.formula == 'harris':
        return 66 + 13.7 * profile.weight
    # –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ñ–æ—Ä–º—É–ª—ã –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å —ç—Ç–æ—Ç –∫–æ–¥!
```

**–•–æ—Ä–æ—à–æ:**
```python
class BMRCalculator(ABC):
    @abstractmethod
    def calculate(self, profile): pass

class MifflinCalculator(BMRCalculator):
    def calculate(self, profile):
        return 10 * profile.weight + 6.25 * profile.height

class HarrisCalculator(BMRCalculator):
    def calculate(self, profile):
        return 66 + 13.7 * profile.weight

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ–æ—Ä–º—É–ª—ã –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
class KatchMcArdleCalculator(BMRCalculator):
    def calculate(self, profile):
        return 370 + 21.6 * profile.lean_body_mass
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ Nutricount:**
- ‚úÖ `frontend/src/adapters/` - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å IndexedDBAdapter
- üìù –°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—á–µ—Ç—ã nutrition extensible

---

### L - Liskov Substitution Principle (–ü—Ä–∏–Ω—Ü–∏–ø –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –ë–∞—Ä–±–∞—Ä—ã –õ–∏—Å–∫–æ–≤)

**–ü—Ä–∞–≤–∏–ª–æ:** –ü–æ–¥–∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –∑–∞–º–µ–Ω—è—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã

**–ü–ª–æ—Ö–æ:**
```python
class Bird:
    def fly(self): pass

class Penguin(Bird):
    def fly(self):
        raise Exception("Penguins can't fly!")  # –ù–∞—Ä—É—à–µ–Ω–∏–µ LSP!
```

**–•–æ—Ä–æ—à–æ:**
```python
class Bird:
    def move(self): pass

class FlyingBird(Bird):
    def move(self):
        self.fly()
    
    def fly(self): pass

class Penguin(Bird):
    def move(self):
        self.swim()
    
    def swim(self): pass
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ Nutricount:**
```python
class BackendAdapter:
    async def getProducts(self): pass

class ApiAdapter(BackendAdapter):
    async def getProducts(self):
        # –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
        return await fetch('/api/products')

class StorageAdapter(BackendAdapter):
    async def getProducts(self):
        # –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
        return JSON.parse(localStorage.getItem('products'))
```

---

### I - Interface Segregation Principle (–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)

**–ü—Ä–∞–≤–∏–ª–æ:** –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –º–µ—Ç–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç

**–ü–ª–æ—Ö–æ:**
```python
class AllInOneAdapter:
    def get_products(self): pass
    def get_dishes(self): pass
    def get_logs(self): pass
    def get_stats(self): pass
    def get_fasting(self): pass
    # –ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ products, –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–≤–∏—Å–∏–º –æ—Ç –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
```

**–•–æ—Ä–æ—à–æ:**
```python
class ProductAdapter:
    def get_products(self): pass
    def save_product(self): pass

class LogAdapter:
    def get_logs(self): pass
    def save_log(self): pass

class StatsAdapter:
    def get_stats(self): pass
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ Nutricount:**
- üìù –†–∞–∑–¥–µ–ª–∏—Ç—å `BackendAdapter` –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

---

### D - Dependency Inversion Principle (–ü—Ä–∏–Ω—Ü–∏–ø –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)

**–ü—Ä–∞–≤–∏–ª–æ:** –ó–∞–≤–∏—Å–µ—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π, –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

**–ü–ª–æ—Ö–æ:**
```python
class ProductService:
    def __init__(self):
        self.db = SQLiteDatabase()  # –ñ–µ—Å—Ç–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å!
    
    def get_products(self):
        return self.db.query("SELECT * FROM products")
```

**–•–æ—Ä–æ—à–æ:**
```python
class Database(ABC):
    @abstractmethod
    def query(self, sql): pass

class SQLiteDatabase(Database):
    def query(self, sql): pass

class PostgreSQLDatabase(Database):
    def query(self, sql): pass

class ProductService:
    def __init__(self, database: Database):  # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
        self.db = database
    
    def get_products(self):
        return self.db.query("SELECT * FROM products")

# Usage
service = ProductService(SQLiteDatabase())  # –õ–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ PostgreSQL
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ Nutricount:**
```javascript
// –•–æ—Ä–æ—à–æ: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
class NutritionApp {
    constructor(adapter) {  // BackendAdapter interface
        this.adapter = adapter;
    }
}

// –ú–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –∞–¥–∞–ø—Ç–µ—Ä
const localApp = new NutritionApp(new ApiAdapter());
const publicApp = new NutritionApp(new StorageAdapter());
```

---

## üéØ Best Practices

### YAGNI (You Aren't Gonna Need It)

**–ü—Ä–∞–≤–∏–ª–æ:** –ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –ø–æ–∫–∞ –æ–Ω–∞ –Ω–µ –Ω—É–∂–Ω–∞

**–ü—Ä–∏–º–µ—Ä—ã –≤ Nutricount:**

**‚úÖ –•–æ—Ä–æ—à–æ:**
```python
# –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –Ω—É–∂–¥
def validate_product(data):
    if not data.get('name'):
        return False, "Name required"
    return True, None
```

**‚ùå –ü–ª–æ—Ö–æ (YAGNI violation):**
```python
# –°–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞
class ValidationRule: pass
class ValidationEngine: pass
class ValidationContext: pass
class ValidationResult: pass
# ... 500 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –ù–∞—á–∞–ª–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ adapter pattern
- –î–æ–±–∞–≤–∏–º Repository pattern —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ë–î —É—Å–ª–æ–∂–Ω–∏—Ç—Å—è
- Command pattern –¥–ª—è undo/redo - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–ø—Ä–æ—Å—è—Ç

---

### KISS (Keep It Simple, Stupid)

**–ü—Ä–∞–≤–∏–ª–æ:** –ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ

**–ü—Ä–∏–º–µ—Ä—ã:**

**‚úÖ –•–æ—Ä–æ—à–æ:**
```javascript
function calculateCalories(protein, fat, carbs) {
    return protein * 4 + fat * 9 + carbs * 4;
}
```

**‚ùå –ü–ª–æ—Ö–æ:**
```javascript
function calculateCalories(macros) {
    const coefficients = new Map([
        [MacroType.PROTEIN, CalorieCoefficients.ATWATER_PROTEIN],
        [MacroType.FAT, CalorieCoefficients.ATWATER_FAT],
        [MacroType.CARBS, CalorieCoefficients.ATWATER_CARBS]
    ]);
    return MacroCalculatorFactory
        .getInstance()
        .createCalculator(CalculatorType.CALORIE)
        .calculate(macros, coefficients);
}
```

---

### DRY (Don't Repeat Yourself)

**–ü—Ä–∞–≤–∏–ª–æ:** –ù–µ –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ—Å—å

**–ü—Ä–∏–º–µ—Ä—ã:**

**‚ùå –ü–ª–æ—Ö–æ:**
```python
@app.route('/api/products')
def get_products():
    token = request.headers.get('Authorization')
    if not token:
        return jsonify({'error': 'No auth'}), 401
    # ...

@app.route('/api/dishes')
def get_dishes():
    token = request.headers.get('Authorization')
    if not token:
        return jsonify({'error': 'No auth'}), 401
    # ... (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ!)
```

**‚úÖ –•–æ—Ä–æ—à–æ:**
```python
def require_auth(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        token = request.headers.get('Authorization')
        if not token:
            return jsonify({'error': 'No auth'}), 401
        return f(*args, **kwargs)
    return decorated

@app.route('/api/products')
@require_auth
def get_products():
    # –ö–æ–¥ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
```

---

## üèóÔ∏è Architectural Patterns

### 1. Layered Architecture (–°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
Presentation Layer (Templates, JS)
         ‚Üì
API Layer (Routes)
         ‚Üì
Business Logic Layer (src/)
         ‚Üì
Data Access Layer (SQLite)
```

**–£–ª—É—á—à–µ–Ω–∏–µ:**
```
Presentation Layer
         ‚Üì
Controller Layer (routes/) - –¢–æ–Ω–∫–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
         ‚Üì
Service Layer (NEW) - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
         ‚Üì
Repository Layer (NEW) - –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
         ‚Üì
Database Layer
```

---

### 2. MVC (Model-View-Controller)

**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:**
```
Model (src/models/) - –î–∞–Ω–Ω—ã–µ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
View (templates/) - –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
Controller (routes/) - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
```

---

### 3. Clean Architecture (–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç UI
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ë–î

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Entities (Business Objects)         ‚îÇ ‚Üê –Ø–¥—Ä–æ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Use Cases (Business Rules)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Interface Adapters (Controllers)    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Frameworks & Drivers (Flask, DB)    ‚îÇ ‚Üê –î–µ—Ç–∞–ª–∏
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ Testing Patterns

### 1. AAA Pattern (Arrange-Act-Assert)

**–£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
```python
def test_calculate_calories():
    # Arrange
    protein, fat, carbs = 20, 10, 30
    
    # Act
    result = calculate_calories(protein, fat, carbs)
    
    # Assert
    assert result == 290  # 20*4 + 10*9 + 30*4
```

---

### 2. Test Fixtures (–§–∏–∫—Å—Ç—É—Ä—ã)

**–¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
@pytest.fixture
def client():
    app.config['TESTING'] = True
    with app.test_client() as client:
        yield client

def test_get_products(client):
    response = client.get('/api/products')
    assert response.status_code == 200
```

---

### 3. Mock Objects (–ú–æ–∫–∏)

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
@patch('src.cache_manager.redis')
def test_cache_with_mock(mock_redis):
    mock_redis.get.return_value = b'cached_data'
    result = cache.get('key')
    assert result == 'cached_data'
```

---

### 4. Test Data Builders

**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:**
```python
class ProductBuilder:
    def __init__(self):
        self.product = {
            'name': 'Test Product',
            'protein': 20,
            'fat': 10,
            'carbs': 5
        }
    
    def with_name(self, name):
        self.product['name'] = name
        return self
    
    def high_protein(self):
        self.product['protein'] = 80
        return self
    
    def build(self):
        return self.product

# Usage in tests
product = ProductBuilder().with_name("Chicken").high_protein().build()
```

---

### 5. Page Object Pattern

**–î–ª—è E2E —Ç–µ—Å—Ç–æ–≤ (Week 4):**
```python
class ProductsPage:
    def __init__(self, driver):
        self.driver = driver
    
    def add_product(self, name, protein, fat, carbs):
        self.driver.find_element_by_id('product-name').send_keys(name)
        self.driver.find_element_by_id('protein').send_keys(protein)
        self.driver.find_element_by_id('submit').click()
    
    def get_products_count(self):
        return len(self.driver.find_elements_by_class('product-item'))

# Test
def test_add_product(driver):
    page = ProductsPage(driver)
    page.add_product("Chicken", 31, 3.6, 0)
    assert page.get_products_count() == 1
```

---

## üìã Implementation Roadmap

### Week 3: Repository & Service Patterns

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å `repositories/` directory
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ProductRepository`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `DishRepository`
- [ ] –°–æ–∑–¥–∞—Ç—å `services/` directory
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ProductService` (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

**–§–∞–π–ª—ã:**
```
src/
‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ product_repository.py
‚îÇ   ‚îî‚îÄ‚îÄ dish_repository.py
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ product_service.py
‚îÇ   ‚îî‚îÄ‚îÄ dish_service.py
```

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**
```python
# repositories/product_repository.py
class ProductRepository:
    def find_all(self): pass
    def find_by_id(self, id): pass
    def save(self, product): pass
    def delete(self, id): pass

# services/product_service.py
class ProductService:
    def __init__(self, repo: ProductRepository):
        self.repo = repo
    
    def create_product(self, data):
        # –í–∞–ª–∏–¥–∞—Ü–∏—è
        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ repo
        pass

# routes/products.py (—Ç–æ–Ω–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
@app.route('/api/products', methods=['POST'])
def create_product():
    service = ProductService(ProductRepository(db))
    product = service.create_product(request.json)
    return jsonify(product), 201
```

---

### Week 4: Strategy & Builder Patterns

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Strategy –¥–ª—è BMR calculations
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Builder –¥–ª—è Dish creation
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Chain of Responsibility –¥–ª—è validation

**BMR Strategy:**
```python
# src/strategies/bmr_strategies.py
class BMRStrategy(ABC):
    @abstractmethod
    def calculate(self, profile): pass

class MifflinStJeor(BMRStrategy): pass
class HarrisBenedict(BMRStrategy): pass
class KatchMcArdle(BMRStrategy): pass

# src/nutrition_calculator.py
class NutritionCalculator:
    def __init__(self, bmr_strategy: BMRStrategy):
        self.bmr_strategy = bmr_strategy
    
    def calculate_bmr(self, profile):
        return self.bmr_strategy.calculate(profile)
```

---

### Week 5: Facade & Proxy Patterns

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NutritionFacade
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CachingProxy –¥–ª—è repositories
- [ ] –î–æ–±–∞–≤–∏—Ç—å Decorator –¥–ª—è rate limiting

**Nutrition Facade:**
```python
class NutritionFacade:
    def analyze_food(self, food_data):
        # –û–¥–∏–Ω –º–µ—Ç–æ–¥ –≤–º–µ—Å—Ç–æ 10 –≤—ã–∑–æ–≤–æ–≤
        return {
            'nutrition': self.calculator.calculate(food_data),
            'keto_index': self.keto.analyze(food_data),
            'validation': self.validator.validate(food_data)
        }
```

---

### Week 6: Testing Patterns & Documentation

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Test Data Builders
- [ ] –î–æ–±–∞–≤–∏—Ç—å Page Object Pattern –¥–ª—è E2E
- [ ] –°–æ–∑–¥–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è integration tests
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

**Test Builder:**
```python
# tests/builders/product_builder.py
class ProductBuilder:
    def with_name(self, name): return self
    def high_protein(self): return self
    def keto_friendly(self): return self
    def build(self): return self.product
```

---

## üìö Learning Materials

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞:**
1. **–ü—Ä–æ–±–ª–µ–º–∞** - –∫–∞–∫—É—é –∑–∞–¥–∞—á—É —Ä–µ—à–∞–µ—Ç
2. **–†–µ—à–µ–Ω–∏–µ** - –∫–∞–∫ –ø–∞—Ç—Ç–µ—Ä–Ω –ø–æ–º–æ–≥–∞–µ—Ç
3. **–ü—Ä–∏–º–µ—Ä** - —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥ –∏–∑ Nutricount
4. **–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ** - –∑–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏
5. **–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã** - —á–µ–≥–æ –∏–∑–±–µ–≥–∞—Ç—å

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
docs/patterns/
‚îú‚îÄ‚îÄ design-patterns/
‚îÇ   ‚îú‚îÄ‚îÄ adapter.md
‚îÇ   ‚îú‚îÄ‚îÄ singleton.md
‚îÇ   ‚îú‚îÄ‚îÄ factory.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ solid-principles/
‚îÇ   ‚îú‚îÄ‚îÄ single-responsibility.md
‚îÇ   ‚îú‚îÄ‚îÄ open-closed.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ best-practices/
‚îÇ   ‚îú‚îÄ‚îÄ yagni.md
‚îÇ   ‚îú‚îÄ‚îÄ kiss.md
‚îÇ   ‚îî‚îÄ‚îÄ dry.md
‚îî‚îÄ‚îÄ architectural-patterns/
    ‚îú‚îÄ‚îÄ layered-architecture.md
    ‚îú‚îÄ‚îÄ mvc.md
    ‚îî‚îÄ‚îÄ clean-architecture.md
```

---

## ‚úÖ Checklist

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] Adapter Pattern (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
- [x] Singleton Pattern (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
- [x] Decorator Pattern (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
- [x] Observer Pattern (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
- [ ] Repository Pattern (Week 3)
- [ ] Strategy Pattern (Week 4)
- [ ] Builder Pattern (Week 4)
- [ ] Factory Pattern (—É–ª—É—á—à–∏—Ç—å Week 3)
- [ ] Facade Pattern (Week 5)
- [ ] Proxy Pattern (Week 5)
- [ ] Chain of Responsibility (Week 4)
- [ ] Command Pattern (Week 5-6)
- [ ] Template Method (—É–ª—É—á—à–∏—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö)

### SOLID Principles
- [x] Single Responsibility (—á–∞—Å—Ç–∏—á–Ω–æ)
- [ ] Open/Closed (—É–ª—É—á—à–∏—Ç—å Week 3-4)
- [x] Liskov Substitution (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
- [ ] Interface Segregation (Week 4)
- [ ] Dependency Inversion (Week 3)

### Best Practices
- [x] KISS (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
- [x] YAGNI (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
- [x] DRY (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- [x] Layered Architecture (–±–∞–∑–æ–≤–∞—è)
- [ ] MVC (—É–ª—É—á—à–∏—Ç—å Week 3)
- [ ] Clean Architecture (Week 4-5)
- [ ] Repository Pattern (Week 3)
- [ ] Service Layer (Week 3)

### Testing Patterns
- [x] AAA Pattern (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
- [x] Test Fixtures (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
- [x] Mock Objects (–ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
- [ ] Test Data Builders (Week 6)
- [ ] Page Object Pattern (Week 4)

---

**Version:** 1.0  
**Date:** October 21, 2025  
**Status:** Planning Complete  
**Implementation:** Weeks 3-6  
**Target:** Maximum pattern demonstration with practical applicability
